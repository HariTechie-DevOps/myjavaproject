<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Forgot Password</title>
<style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; }
    .container { width: 360px; margin: 40px auto; background: #fff; padding: 25px; border-radius: 6px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h2 { text-align: center; margin-bottom: 20px; }
    label { display: block; margin-top: 12px; font-weight: 600; }
    .input-group { display: flex; }
    select, input { width: 100%; padding: 10px; margin-top: 6px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
    select { width: 35%; margin-right: 6px; }
    .error { color: red; font-size: 12px; display: none; margin-top: 5px; }
    button { width: 100%; padding: 10px; margin-top: 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
    
    /* Hide steps initially */
    .step { display: none; }
    .step.active { display: block; }
</style>
</head>
<body>

<div class="container">
    <h2>Reset Password</h2>

    <div id="step1" class="step active">
        <label>Enter Registered Mobile</label>
        <div class="input-group">
            <select id="code">
                <option value="+91">+91</option>
                <option value="+1">+1</option>
            </select>
            <input id="mobile" placeholder="Phone Number">
        </div>
        <div class="error" id="mobileError"></div>
        <button onclick="sendOtp()">Send OTP</button>
    </div>

    <div id="step2" class="step">
        <label>Enter 6-Digit OTP</label>
        <input id="otp" type="text" maxlength="6" placeholder="000000">
        <div class="error" id="otpError"></div>
        <button onclick="verifyOtp()">Verify OTP</button>
    </div>

    <div id="step3" class="step">
        <label>New Password</label>
        <input id="newPassword" type="password" placeholder="Min 6 characters">
        <label>Confirm New Password</label>
        <input id="confirmPassword" type="password">
        <div class="error" id="passwordError"></div>
        <button onclick="updatePassword()">Update Password</button>
    </div>
</div>

<script>
let userMobile = "";

function showStep(stepNumber) {
    document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
    document.getElementById('step' + stepNumber).classList.add('active');
}

// 1. Send OTP Request
function sendOtp() {
    const mobileInput = document.getElementById("mobile").value;
    const code = document.getElementById("code").value;
    userMobile = code + mobileInput;

    if(mobileInput.length < 10) {
        document.getElementById("mobileError").innerText = "Enter valid mobile";
        document.getElementById("mobileError").style.display = "block";
        return;
    }

    fetch("/api/forgot-password/send-otp", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ mobile: userMobile })
    })
    .then(res => res.json())
    .then(data => {
        if(data.success) {
            alert("OTP sent to " + userMobile);
            showStep(2);
        } else {
            alert(data.message);
        }
    });
}

// 2. Verify OTP Request
function verifyOtp() {
    const otp = document.getElementById("otp").value;
    
    fetch("/api/forgot-password/verify-otp", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ mobile: userMobile, otp: otp })
    })
    .then(res => res.json())
    .then(data => {
        if(data.success) {
            showStep(3);
        } else {
            document.getElementById("otpError").innerText = "Invalid OTP";
            document.getElementById("otpError").style.display = "block";
        }
    });
}

// 3. Final Password Update
function updatePassword() {
    const newPass = document.getElementById("newPassword").value;
    const confPass = document.getElementById("confirmPassword").value;

    if(newPass !== confPass) {
        document.getElementById("passwordError").innerText = "Passwords do not match";
        document.getElementById("passwordError").style.display = "block";
        return;
    }

    fetch("/api/forgot-password/update", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ mobile: userMobile, newPassword: newPass })
    })
    .then(res => res.json())
    .then(data => {
        if(data.success) {
            alert("Password Changed Successfully!");
            window.location.href = "signin.html";
        }
    });
}
</script>
</body>
</html>
