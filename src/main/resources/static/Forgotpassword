<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Forgot Password</title>
    <style>
        body { font-family: Arial; background: #f5f5f5; }
        .box { width: 360px; margin: 50px auto; background: white; padding: 25px; border-radius: 6px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h2 { text-align: center; }
        label { margin-top: 12px; display:block; font-weight: 600; }
        input { width:100%; padding:10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        .error { color:red; font-size:12px; display:none; margin-top: 5px; }
        button { width:100%; margin-top:20px; padding:10px; background:#007bff; color:white; border:none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .back-link { display: block; text-align: center; margin-top: 15px; font-size: 13px; color: #007bff; text-decoration: none; }
    </style>
</head>
<body>

<div class="box">
    <h2>Forgot Password</h2>

    <label>Name</label>
    <input id="name" placeholder="Your full name">
    <div class="error" id="nameError"></div>

    <label>Mobile</label>
    <input id="mobile" placeholder="+91...">
    <div class="error" id="mobileError"></div>

    <label>New Password</label>
    <input id="newPassword" type="password">

    <label>Confirm Password</label>
    <input id="confirmPassword" type="password">
    <div class="error" id="passwordError"></div>

    <button onclick="reset()">Proceed</button>
    <a href="signin.html" class="back-link">Back to Sign In</a>
</div>

<script>
function reset() {
    // Reset errors
    document.querySelectorAll(".error").forEach(e => e.style.display="none");

    // Correctly fetching values from input elements
    const name = document.getElementById("name").value;
    const mobile = document.getElementById("mobile").value;
    const newPassword = document.getElementById("newPassword").value;
    const confirmPassword = document.getElementById("confirmPassword").value;
    const passwordError = document.getElementById("passwordError");

    // Frontend validation for matching passwords
    if (newPassword !== confirmPassword) {
        passwordError.innerText = "Passwords do not match";
        passwordError.style.display = "block";
        return;
    }

    if (!newPassword || newPassword.length < 6) {
        passwordError.innerText = "Password must be at least 6 characters";
        passwordError.style.display = "block";
        return;
    }

    fetch("/api/forgot-password", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({ name, mobile, newPassword })
    })
    .then(res => res.json())
    .then(data => {
        if(!data.success){
            // Checking for dynamic field errors from backend (e.g. mobileError)
            const errField = data.field ? data.field : "mobile";
            const errDiv = document.getElementById(errField + "Error");
            if(errDiv) {
                errDiv.innerText = data.message;
                errDiv.style.display = "block";
            } else {
                alert(data.message);
            }
            return;
        }
        alert("Password updated successfully!");
        window.location.href = "signin.html";
    })
    .catch(err => alert("Error connecting to server."));
}
</script>

</body>
</html>
